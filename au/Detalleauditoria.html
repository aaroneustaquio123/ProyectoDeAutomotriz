<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Summas - Detalle Auditoría</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styledetalleauditoria.css">
    <link rel="icon" type="image/png" href="../LogoSummas.png"> 
</head>
<body>
    <header>
        <div class="logo-container">
            <img src="../LogoSummas.png" alt="Summas Consultoría">
        </div>
        <nav>
            <a href="../dash/dashboard.html">Dashboard</a>
            <a href="auditorias.html">Auditorías</a>
            <a href="../plan/plantillas.html">Plantillas</a>
            <a href="../em/empresa.html">Empresas</a>
        </nav>
        <div class="user-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
        </div>
    </header>

    <div class="content" id="mainContent">
        <!-- Botón Volver -->
        <div class="page-top">
            <button class="btn-back" onclick="window.location.href='auditorias.html'">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
                Volver
            </button>
        </div>

        <!-- Barra de Progreso -->
        <div class="progress-bar-card">
            <span class="progress-label">Progreso</span>
            <div class="progress-bar-track">
                <div class="progress-fill-green" id="progressGreen"></div>
                <div class="progress-fill-red" id="progressRed"></div>
            </div>
            <span class="progress-count" id="progressCount">0/0</span>
        </div>

        <!-- Sección de evaluación -->
        <div class="eval-card" id="evalCard">
            <!-- Se llena dinámicamente -->
        </div>

        <!-- Navegación -->
        <div class="nav-container">
            <button class="btn-anterior" id="btnAnterior" style="display:none;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
                Anterior
            </button>
            <button class="btn-siguiente" id="btnSiguiente">Siguiente</button>
        </div>
    </div>

    <!-- ========== RESUMEN DE RESULTADOS ========== -->
    <div class="content results-content" id="resultsContent" style="display:none;">
        <div class="results-card" id="resultsCard">
            <div class="results-header">
                <h2 class="results-title">Resumen de Resultados</h2>
                <button class="btn-download" id="btnDownload" title="Descargar Resultados Completos">
                    <span>Descargar Resultados Completos</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </button>
            </div>

            <div class="results-table-container">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th class="col-section"></th>
                            <th class="col-num">Obtenido</th>
                            <th class="col-num">Máximo</th>
                            <th class="col-pct">%</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody"></tbody>
                </table>
            </div>

            <div class="results-total" id="resultsTotal"></div>
        </div>

        <div class="results-actions">
            <button class="btn-anterior" id="btnVolverAuditoria">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
                Volver a la Auditoría
            </button>
            <button class="btn-dashboard" onclick="window.location.href='dashboardresultados.html'">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                Ver Dashboard Completo
            </button>
            <button class="btn-siguiente" onclick="window.location.href='auditorias.html'">Ir a Auditorías</button>
        </div>
    </div>

    <!-- Modal ¿Cómo validó? -->
    <div id="comoValidoModal" class="modal-overlay">
        <div class="modal-sm">
            <div class="modal-sm-header">
                <h3>¿Cómo validó?</h3>
                <span class="modal-close" id="closeComoValido">&times;</span>
            </div>
            <div class="modal-sm-body">
                <textarea id="comoValidoText" class="modal-textarea" placeholder="Describa cómo se validó este punto..."></textarea>
            </div>
            <div class="modal-sm-logo">
                <img src="../LogoSummas.png" alt="Summas Consultoría">
            </div>
            <div class="modal-sm-footer">
                <button class="btn-modal-cancel" id="cancelComoValido">Cancelar</button>
                <button class="btn-modal-save" id="saveComoValido">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal Comentario -->
    <div id="comentarioModal" class="modal-overlay">
        <div class="modal-sm">
            <div class="modal-sm-header">
                <h3>Comentario</h3>
                <span class="modal-close" id="closeComentario">&times;</span>
            </div>
            <div class="modal-sm-body">
                <textarea id="comentarioText" class="modal-textarea" placeholder="Escriba su comentario..."></textarea>
            </div>
            <div class="modal-sm-footer">
                <button class="btn-modal-cancel" id="cancelComentario">Cancelar</button>
                <button class="btn-modal-save" id="saveComentario">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal Evidencia — CARRUSEL 3 SLOTS -->
    <div id="evidenciaModal" class="modal-overlay">
        <div class="modal-sm modal-evidencia-sm">
            <div class="modal-sm-header">
                <h3>Evidencia</h3>
                <span class="modal-close" id="closeEvidencia">&times;</span>
            </div>
            <div class="modal-sm-body evidencia-body">
                <!-- Carrusel con flechas -->
                <div class="ev-carousel-wrapper">
                    <button class="ev-nav-btn ev-prev" id="evPrev">&#8249;</button>
                    <div class="ev-slot-container" id="evSlotContainer">
                        <!-- Renderizado por JS -->
                    </div>
                    <button class="ev-nav-btn ev-next" id="evNext">&#8250;</button>
                </div>
                <!-- Indicadores de puntos -->
                <div class="ev-dots" id="evDots">
                    <span class="ev-dot active" data-idx="0"></span>
                    <span class="ev-dot" data-idx="1"></span>
                    <span class="ev-dot" data-idx="2"></span>
                </div>
                <input type="file" id="evidenciaFile" hidden accept="image/*,.pdf">
            </div>
            <div class="modal-sm-footer">
                <button class="btn-modal-cancel" id="cancelEvidencia">Cancelar</button>
                <button class="btn-modal-save" id="saveEvidencia">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal Plan de Acción -->
    <div id="planAccionModal" class="modal-overlay">
        <div class="modal-sm">
            <div class="modal-sm-header">
                <h3>Plan de Acción</h3>
                <span class="modal-close" id="closePlanAccion">&times;</span>
            </div>
            <div class="modal-sm-body">
                <div class="plan-field">
                    <label>Responsable</label>
                    <input type="text" id="planResponsable" class="modal-input" placeholder="Nombre del responsable">
                </div>
                <div class="plan-field">
                    <label>Descripción de la acción</label>
                    <textarea id="planDescripcion" class="modal-textarea" placeholder="Describa la acción correctiva..."></textarea>
                </div>
                <div class="plan-field">
                    <label>Fecha límite</label>
                    <input type="date" id="planFecha" class="modal-input">
                </div>
            </div>
            <div class="modal-sm-footer">
                <button class="btn-modal-cancel" id="cancelPlanAccion">Cancelar</button>
                <button class="btn-modal-save" id="savePlanAccion">Guardar</button>
            </div>
        </div>
    </div>
    <script src="scriptdetalleauditoria.js"></script>
</body>
</html>